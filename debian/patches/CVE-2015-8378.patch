Description: Abort file save dialog gracefully on 'cancel'
Author: Reinhard Tartler <siretart@debian.org>
Bug-Debian: 791858

The Qt documentation says that pressing the "Cancel" button "returns a
null string" (cf http://doc.qt.io/qt-4.8/qfiledialog.html#details). The
default (and only) implementation of the File dialog ignores this case
and wrongly constructs a bogus filename. This patch bails out gracefully
and avoids cleartext passwords on the hard disk.

Fixes CVE-2015-8378

--- a/src/lib/FileDialogs.cpp
+++ b/src/lib/FileDialogs.cpp
@@ -118,6 +118,11 @@ QString QtStandardFileDialogs::saveFileD
 		SelectedFilter=Filters[SelectedFilterIndex];
 	QString filepath = QFileDialog::getSaveFileName(parent,title,dir,toSingleStringFilter(Filters),&SelectedFilter,
 	                                                ShowOverwriteWarning ? (QFileDialog::Option)0 : QFileDialog::DontConfirmOverwrite);
+
+        // Fixes CVE-2015-8378
+        if (filepath.isEmpty())
+            return filepath;
+
 	LastFilter=Filters.indexOf(SelectedFilter);
 		
 	//Check whether the file has an extension which fits to the selected filter
